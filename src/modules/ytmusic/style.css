/* ==========================================================================
   YTMUSIC PATCHING & LAYOUT
   ========================================================================== */

/* Import SF Pro Display font from CDN */
@import url('https://fonts.cdnfonts.com/css/sf-pro-display');

/* Apply SF Pro Display font to YouTube Music elements */
ytmusic-app,
ytmusic-player-page,
ytmusic-tab-renderer,
#lyrics-plus-container {
    font-family: 'SF Pro Display' !important;
}

/* Hide default YouTube Music lyrics UI components when Lyrics Plus is active */
ytmusic-section-list-renderer[page-type="MUSIC_PAGE_TYPE_TRACK_LYRICS"] #contents.ytmusic-section-list-renderer,
ytmusic-message-renderer.style-scope.ytmusic-tab-renderer[style=""],
ytmusic-tab-renderer:has(#lyrics-plus-container[style*="display: block"]) ytmusic-message-renderer,
ytmusic-tab-renderer:has(#lyrics-plus-container[style*="display: block"]) .loading-spinner {
    display: none !important;
}

ytmusic-app-layout[player-fullscreened] .song-media-controls.ytmusic-player {
    background: none;
}

/* Use song-art palette for lyrics in word-by-word mode */
ytmusic-player-page[video-mode]:not([is-video-truncation-fix-enabled])[player-fullscreened] #lyrics-plus-container.use-song-palette-fullscreen.word-by-word-mode,
#lyrics-plus-container.use-song-palette-all-modes.word-by-word-mode {
    --lyplus-lyrics-pallete: var(--lyplus-song-pallete);
}

/* Use white-variant of song-art palette for lyrics in line-by-line mode */
ytmusic-player-page[video-mode]:not([is-video-truncation-fix-enabled])[player-fullscreened] #lyrics-plus-container.use-song-palette-fullscreen.line-by-line-mode,
#lyrics-plus-container.use-song-palette-all-modes.line-by-line-mode {
    --lyplus-lyrics-pallete: var(--lyplus-song-white-pallete);
}


ytmusic-tab-renderer:has(#lyrics-plus-container[style*="display: block"]) {
    --lyrics-scroll-padding-top: 25%;
    overflow: hidden;
    scrollbar-width: none;
    will-change: scroll-position;
}

ytmusic-app-layout[is-mweb-modernization-enabled] ytmusic-tab-renderer:has(#lyrics-plus-container[style*="display: block"]) {
    --lyrics-scroll-padding-top: 10%;
}

/* Modern mobile layout font size */
ytmusic-app-layout[is-mweb-modernization-enabled] .lyrics-plus-integrated .lyrics-line {
    font-size: 34px;
}

/* Apply a lesser blur to lines immediately adjacent to the active one */
ytmusic-player-page:not([player-fullscreened]) #lyrics-plus-container.blur-inactive-enabled:not(.not-focused) .lyrics-line:not(.active)[class*="next-"]:not(.lyrics-gap) {
    filter: blur(0.035em);
}


/* Show buttons only when lyrics are visible */
ytmusic-tab-renderer:has(#lyrics-plus-container[style*="display: block"]) #lyrics-plus-buttons-wrapper {
    display: flex;
}


/* --- Dynamic Player UI Integration --- */

/* Show blur background when player page is open or in fullscreen */
#layout.dynamic-player[player-ui-state="PLAYER_PAGE_OPEN"] .lyplus-blur-container,
#layout.dynamic-player[is-mweb-modernization-enabled][player-ui-state="MINIPLAYER_IN_PLAYER_PAGE"] .lyplus-blur-container,
ytmusic-app #layout.dynamic-player[player-ui-state="FULLSCREEN"] .lyplus-blur-container {
    display: block;
    opacity: 1;
}

/* Make backgrounds transparent to reveal the blur container */
#layout.dynamic-player[player-ui-state="PLAYER_PAGE_OPEN"] #mini-guide-background,
#layout.dynamic-player[player-ui-state="PLAYER_PAGE_OPEN"] #nav-bar-background,
#layout.dynamic-player[player-ui-state="PLAYER_PAGE_OPEN"] #guide-wrapper,
#layout.dynamic-player[player-ui-state="PLAYER_PAGE_OPEN"] ytmusic-player-page#player-page,
#layout.dynamic-player[player-ui-state="PLAYER_PAGE_OPEN"] #player-bar-background,
#layout.dynamic-player[player-ui-state="PLAYER_PAGE_OPEN"] ytmusic-player-bar,
#layout.dynamic-player[player-ui-state="PLAYER_PAGE_OPEN"] #nav-bar-divider.ytmusic-app-layout {
    background: transparent !important;
}

#layout.dynamic-player[player-ui-state="PLAYER_PAGE_OPEN"] #nav-bar-divider.ytmusic-app-layout,
#layout.dynamic-player[player-ui-state="MINIPLAYER_IN_PLAYER_PAGE"] #nav-bar-divider.ytmusic-app-layout,
#layout.dynamic-player[player-ui-state="PLAYER_PAGE_OPEN"] #mini-guide-background,
#layout.dynamic-player[player-ui-state="PLAYER_PAGE_OPEN"] #nav-bar-background {
    border-color: transparent !important;
}

/* Style adjustments for modern mobile view */
#layout.dynamic-player[is-mweb-modernization-enabled] .side-panel.ytmusic-player-page,
#layout.dynamic-player[is-mweb-modernization-enabled][player-page-ui-state="TABS_VIEW"] #side-panel.ytmusic-player-page,
#layout.dynamic-player[is-mweb-modernization-enabled][player-ui-state="PLAYER_PAGE_OPEN"] .background-gradient,
#layout.dynamic-player[is-mweb-modernization-enabled][player-ui-state="MINIPLAYER_IN_PLAYER_PAGE"] .background-gradient,
#layout.dynamic-player[is-mweb-modernization-enabled][player-ui-state="MINIPLAYER_IN_PLAYER_PAGE"] #player-page,
#layout.dynamic-player[is-mweb-modernization-enabled][player-ui-state="MINIPLAYER_IN_PLAYER_PAGE"] #top-player-bar,
#layout.dynamic-player[is-mweb-modernization-enabled][player-ui-state="MINIPLAYER_IN_PLAYER_PAGE"] #player-bar-background,
#layout.dynamic-player[is-mweb-modernization-enabled][player-ui-state="MINIPLAYER_IN_PLAYER_PAGE"] #nav-bar-background,
#layout.dynamic-player[is-mweb-modernization-enabled][player-ui-state="MINIPLAYER_IN_PLAYER_PAGE"] #mini-guide,
#layout.dynamic-player[is-mweb-modernization-enabled][player-ui-state="MINIPLAYER_IN_PLAYER_PAGE"] #mini-guide-background,
#layout.dynamic-player[is-mweb-modernization-enabled][player-ui-state="PLAYER_PAGE_OPEN"] #mini-guide {
    background: none !important;
}

/* Hide the default image to prevent conflict with our blur container */
#layout.dynamic-player .background-image {
    visibility: hidden !important;
}

#layout.dynamic-player[player-ui-state="PLAYER_PAGE_OPEN"] .lyplus-blur-container::after {
    backdrop-filter: brightness(0.5) saturate(1.4) contrast(1.1);
}

#layout.dynamic-player[player-ui-state="PLAYER_PAGE_OPEN"] ytmusic-player-bar {
    backdrop-filter: blur(20px);
}

#layout.dynamic-player[player-ui-state="PLAYER_PAGE_OPEN"] :not([player-fullscreened]) ytmusic-player {
    border: none;
    border-radius: 2em;
    box-shadow: 0 1em 3em #00000038;
}

/* ==========================================================================
   DESKTOP & FULLSCREEN STYLES (@media)
   ========================================================================== */

@media (min-width: 615px) {

    /* --- General Adjustments --- */
    ytmusic-player-page[player-fullscreened] #lyrics-plus-buttons-wrapper {
        display: none !important;
    }

    ytmusic-app-layout[player-fullscreened][show-fullscreen-controls]>[slot="player-bar"] {
        width: 100%;
    }

    /* --- Non-Video, Non-Fullscreen Player Page --- */
    ytmusic-player-page:not([video-mode]):not([player-fullscreened]):not([player-ui-state="MINIPLAYER"]) #player.ytmusic-player-page {
        left: 50%;
        max-width: 400px !important;
        transform: translateX(-55%);
    }

    ytmusic-player-page:not([is-mweb-modernization-enabled])[player-fullscreened] .av.ytmusic-player-page {
        width: 40% !important;
    }

    /* --- Non-Video, Fullscreen Player Page --- */
    ytmusic-player-page:not([video-mode]):not([is-video-truncation-fix-enabled])[player-fullscreened]:has(#lyrics-plus-container[style*="display: block"]) #player.ytmusic-player-page {
        top: calc(50% - var(--ytmusic-nav-bar-height));
        left: 30%;
        width: 45rem;
        height: 45rem;
        border: none;
        border-radius: 1em;
        box-shadow: 0 1em 3em #00000038;
        mask-image: none !important;
        transform: translate(-60%, -50%);
    }

    ytmusic-app-layout:not([is-mweb-modernization-enabled])[player-fullscreened]>[slot="player-page"] {
        width: 100% !important;
        height: 100% !important;
        background: none !important;
    }

    ytmusic-app-layout:not([is-mweb-modernization-enabled])[player-fullscreened]>[slot="player-page"] .tab-header-container {
        display: none !important;
    }

    ytmusic-app-layout:not([is-mweb-modernization-enabled])[player-fullscreened]>[slot="player-page"] #side-panel {
        min-width: 50%;
        mask-image: linear-gradient(to bottom, transparent 0%, black 26%, black 70%, transparent 100%);
        transform: translateY(-8.8rem);
        interactivity: auto !important;
    }

    ytmusic-app-layout:not([is-mweb-modernization-enabled])[player-fullscreened] .lyplus-blur-container .lyplus-gradient-overlay {
        opacity: 0;
    }

    ytmusic-app-layout:not([is-mweb-modernization-enabled])[player-fullscreened]>[slot="player-page"] #lyrics-plus-container {
        margin-top: 10%;
        padding-top: calc(1em + 40%);
    }

    ytmusic-app-layout:not([is-mweb-modernization-enabled])[player-fullscreened]>[slot="player-page"] #side-panel .lyrics-line {
        margin-bottom: .5rem;
        font-size: 4.5rem;
    }

    ytmusic-app-layout:not([is-mweb-modernization-enabled])[player-fullscreened]>[slot="player-page"] .lyrics-line:not(.active) .main-vocal-container {
        transform: scale3d(0.8, 0.8, 0.95);
    }

    ytmusic-player-page:not([is-video-truncation-fix-enabled])[player-fullscreened] #lyrics-plus-container[style*="display: block"] {
        scroll-padding-top: 35%;
        scroll-padding-block-start: 35%;
    }

    /* --- Video-Mode, Fullscreen (Karaoke Style) --- */
    ytmusic-player-page[video-mode]:not([is-video-truncation-fix-enabled])[player-fullscreened]:has(#lyrics-plus-container[style*="display: block"]) #lyrics-plus-container {
        margin-top: 0;
        padding-top: 0;
    }

    ytmusic-player-page[video-mode]:not([is-video-truncation-fix-enabled])[player-fullscreened]:has(#lyrics-plus-container[style*="display: block"]) #side-panel {
        position: absolute;
        bottom: 9rem;
        left: 0;
        z-index: 2;
        width: 100vw !important;
        min-width: 100vw;
        height: 9em;
        margin: 0;
        box-sizing: border-box;
        text-align: center !important;
        pointer-events: none;
        overflow: visible;
        mask-image: none;
    }

    ytmusic-player-page[video-mode]:not([is-video-truncation-fix-enabled])[player-fullscreened]:has(#lyrics-plus-container[style*="display: block"]) ytmusic-tab-renderer {
        overflow: visible !important;
    }

    ytmusic-player-page[video-mode]:not([is-video-truncation-fix-enabled])[player-fullscreened]:has(#lyrics-plus-container[style*="display: block"]) .lyrics-line {
        display: none;
        /* Hide all lines by default */
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
        opacity: 0;
        text-align: center !important;
        transform: none !important;
    }

    /* Only show the active and adjacent lines */
    ytmusic-player-page[video-mode]:not([is-video-truncation-fix-enabled])[player-fullscreened]:has(#lyrics-plus-container[style*="display: block"]) .lyrics-line.lyrics-activest,
    ytmusic-player-page[video-mode]:not([is-video-truncation-fix-enabled])[player-fullscreened]:has(#lyrics-plus-container[style*="display: block"]) .lyrics-line.next-active-line,
    ytmusic-player-page[video-mode]:not([is-video-truncation-fix-enabled])[player-fullscreened]:has(#lyrics-plus-container[style*="display: block"]) .lyrics-line.pre-active-line {
        display: block;
    }

    ytmusic-player-page[video-mode]:not([is-video-truncation-fix-enabled])[player-fullscreened]:has(#lyrics-plus-container[style*="display: block"]) .lyrics-line.fullscreen-focused.active {
        opacity: 1;
        filter: drop-shadow(0 0 0.1em rgba(0, 0, 0, 1));
    }

    /* Hide metadata in video mode */
    ytmusic-player-page[video-mode]:not([is-video-truncation-fix-enabled])[player-fullscreened]:has(#lyrics-plus-container[style*="display: block"]) span.lyrics-song-writters,
    ytmusic-player-page[video-mode]:not([is-video-truncation-fix-enabled])[player-fullscreened]:has(#lyrics-plus-container[style*="display: block"]) span.lyrics-source-provider {
        display: none;
    }

    ytmusic-player-page[video-mode]:not([is-video-truncation-fix-enabled])[player-fullscreened]:has(#lyrics-plus-container[style*="display: block"]) .lyrics-line.lyrics-gap .main-vocal-container {
        transform-origin: center !important;
    }
}

#lyrics-plus-container {
    --lyplus-font-family: 'SF Pro Display';
}

/* Fix UI when user using ThemeSong Extension, so using this css will aloow them to use
Lyrics+ without any visual bug*/
#songDivContainer {
    display: none !important;
}
:root:has(#ThemeSong-MainContainer) {
#thumbnail>img {
    object-fit: contain !important;
}

    #layout.dynamic-player #player-page,
    #player-page[player-fullscreened] {
        background: none !important;
    }

    ytmusic-app-layout[player-fullscreened] #player-bar-background.ytmusic-app-layout {
        display: block;
        backdrop-filter: none !important;
        background: transparent !important;
    }

    body:has(#ThemeSong-MainContainer #DynamicLight) ytmusic-player-page:not([player-fullscreened]) #lyrics-plus-container,
    body:has(#ThemeSong-MainContainer #StaticLight) ytmusic-player-page:not([player-fullscreened]) #lyrics-plus-container {
        --lyplus-lyrics-pallete: var(--ts-palette-darkmuted-hex, #111) !important;
        --lyplus-text-secondary: #1116;
        --lyplus-text-tertiary: #ffffff7a;
        --lyplus-text-inactive: #ffffff31;
    }

    body:has(#ThemeSong-MainContainer #DynamicLight) #layout.dynamic-player[player-ui-state="PLAYER_PAGE_OPEN"] .lyplus-blur-container::after {
        backdrop-filter: saturate(1.2) ;
    }
    body:has(#ThemeSong-MainContainer #DynamicLight) #layout.dynamic-player[player-ui-state="PLAYER_PAGE_OPEN"] .lyplus-blur-container canvas {
        opacity: .4;
        filter: brightness(1.8) contrast(0.6);
    }
}

/* ==========================================================================
   SIDEBAR ICON OVERRIDES
   ========================================================================== */

/* Home icon */
ytmusic-guide-entry-renderer.ytmusic-guide-section-renderer.style-scope:nth-of-type(1) yt-icon svg path {
    d: path("M12 4.33L19 10.45V20H15V14H9V20H5V10.45L12 4.33ZM12 3L4 10V21H10V15H14V21H20V10L12 3Z") !important;
}

/* Library icon */
ytmusic-guide-entry-renderer.ytmusic-guide-section-renderer.style-scope:nth-of-type(2) yt-icon svg path {
    d: path("M9.8 9.8L5.97 18.03L14.2 14.2L18.03 5.97L9.8 9.8ZM13.08 12.77C12.87 13.06 12.57 13.25 12.22 13.31C12.15 13.32 12.07 13.33 12 13.33C11.72 13.33 11.46 13.25 11.23 13.08C10.94 12.87 10.75 12.57 10.69 12.22C10.63 11.87 10.71 11.51 10.92 11.23C11.13 10.94 11.43 10.75 11.78 10.69C12.13 10.63 12.48 10.71 12.77 10.92C13.06 11.13 13.25 11.43 13.31 11.78C13.37 12.13 13.29 12.48 13.08 12.77ZM12 3C16.96 3 21 7.04 21 12C21 16.96 16.96 21 12 21C7.04 21 3 16.96 3 12C3 7.04 7.04 3 12 3ZM12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2Z") !important;
}

/* Explore icon */
ytmusic-guide-entry-renderer.ytmusic-guide-section-renderer.style-scope:nth-of-type(3) yt-icon svg path {
    d: path("M11 7L17 10.5L11 14V7ZM18 20H4V6H3V21H18V20ZM21 18H6V3H21V18ZM7 17H20V4H7V17Z") !important;
}

/* Playlist icon */
ytmusic-guide-entry-renderer.ytmusic-guide-section-renderer.style-scope:nth-of-type(4) {
    display: none !important;
    visibility: hidden !important;
    height: 0 !important;
    width: 0 !important;
    margin: 0 !important;
    padding: 0 !important;
    overflow: hidden !important;
}

/* ==========================================================================
   PLAYER BUTTON ICON OVERRIDES
   ========================================================================== */

/* Pause button icon */
ytmusic-player-bar #play-pause-button[aria-label="Pause"] yt-icon svg path,
ytmusic-player-bar #play-pause-button[aria-label="Pause"] svg path,
ytmusic-player-bar yt-icon-button[aria-label="Pause"] yt-icon svg path,
ytmusic-player-bar button[aria-label="Pause"] yt-icon svg path,
ytmusic-player-bar yt-icon[aria-label="Pause"] svg path,
ytmusic-player-bar [aria-label="Pause"] svg path {
    d: path("M5 21H9.30769V3H5V21ZM14.6923 21H19V3H14.6923V21Z") !important;
}

/* Play button icon */
ytmusic-player-bar #play-pause-button[aria-label="Play"] yt-icon svg path,
ytmusic-player-bar #play-pause-button[aria-label="Play"] svg path,
ytmusic-player-bar yt-icon-button[aria-label="Play"] yt-icon svg path,
ytmusic-player-bar button[aria-label="Play"] yt-icon svg path,
ytmusic-player-bar yt-icon[aria-label="Play"] svg path,
ytmusic-player-bar [aria-label="Play"] svg path {
    d: path("M5 22L13.5 17V7L5 2V22ZM13.5 17L22 12L13.5 7V17ZZ") !important;
}

/* Next button icon */
ytmusic-player-bar #play-pause-button[aria-label="Next"] yt-icon svg path,
ytmusic-player-bar #play-pause-button[aria-label="Next"] svg path,
ytmusic-player-bar yt-icon-button[aria-label="Next"] yt-icon svg path,
ytmusic-player-bar button[aria-label="Next"] yt-icon svg path,
ytmusic-player-bar yt-icon[aria-label="Next"] svg path,
ytmusic-player-bar [aria-label="Next"] svg path {
    d: path("M20 4H17.3333V20H20V4ZM15.3333 12L4 20V4L15.3333 12Z") !important;
}

/* Previous button icon */
ytmusic-player-bar #play-pause-button[aria-label="Previous"] yt-icon svg path,
ytmusic-player-bar #play-pause-button[aria-label="Previous"] svg path,
ytmusic-player-bar yt-icon-button[aria-label="Previous"] yt-icon svg path,
ytmusic-player-bar button[aria-label="Previous"] yt-icon svg path,
ytmusic-player-bar yt-icon[aria-label="Previous"] svg path,
ytmusic-player-bar [aria-label="Previous"] svg path {
    d: path("M4 4H6.66667V20H4V4ZM8.66667 12L20 20V4L8.66667 12Z") !important;
}

/* Like button icon */
/* Dislike button icon */
/* Mute button icon */
ytmusic-player-bar #play-pause-button[aria-label="Mute"] yt-icon svg path,
ytmusic-player-bar #play-pause-button[aria-label="Mute"] svg path,
ytmusic-player-bar yt-icon-button[aria-label="Mute"] yt-icon svg path,
ytmusic-player-bar button[aria-label="Mute"] yt-icon svg path,
ytmusic-player-bar yt-icon[aria-label="Mute"] svg path,
ytmusic-player-bar [aria-label="Mute"] svg path {
    d: path("M2 15.75H7.03704L13.3333 22V2L7.03704 8.25H2V15.75ZM15.8519 7V17C17.7156 16.15 19 14.2125 19 12C19 9.825 17.7156 7.925 15.8519 7Z") !important;
}
/* Unmute button icon */
ytmusic-player-bar #play-pause-button[aria-label="Unmute"] yt-icon svg path,
ytmusic-player-bar #play-pause-button[aria-label="Unmute"] svg path,
ytmusic-player-bar yt-icon-button[aria-label="Unmute"] yt-icon svg path,
ytmusic-player-bar button[aria-label="Unmute"] yt-icon svg path,
ytmusic-player-bar yt-icon[aria-label="Unmute"] svg path,
ytmusic-player-bar [aria-label="Unmute"] svg path {
    d: path("M17.75 12.0056C17.75 10.0378 16.56 8.34797 14.8333 7.52529V9.98221L17.6917 12.7059C17.7267 12.4836 17.75 12.2501 17.75 12.0056ZM20.6667 12.0056C20.6667 13.0506 20.4333 14.0289 20.0367 14.9405L21.7983 16.6192C22.5683 15.2407 23 13.6732 23 12.0056C23 7.24736 19.5117 3.26737 14.8333 2.26682V4.54586C18.205 5.50195 20.6667 8.48138 20.6667 12.0056V12.0056ZM3.48167 2L2 3.40078L7.50667 8.65926H2V15.3296H6.66667L12.5 20.8883V13.4063L17.4583 18.1312C16.6767 18.7093 15.8017 19.1651 14.8333 19.443V21.7332C16.4433 21.3886 17.9017 20.677 19.1383 19.721L21.5183 22L23 20.5881L12.5 10.5825L3.49333 2H3.48167ZM12.4883 3.10061L10.05 5.41301L12.4883 7.73652V3.11173V3.10061Z") !important;
}

/* Repeat button icon */
ytmusic-player-bar #play-pause-button[aria-label="Repeat Off"] yt-icon svg path,
ytmusic-player-bar #play-pause-button[aria-label="Repeat Off"] svg path,
ytmusic-player-bar yt-icon-button[aria-label="Repeat Off"] yt-icon svg path,
ytmusic-player-bar button[aria-label="Repeat Off"] yt-icon svg path,
ytmusic-player-bar yt-icon[aria-label="Repeat Off"] svg path,
ytmusic-player-bar [aria-label="Repeat Off"] svg path {
    d: path("M4 4H6.66667V20H4V4ZM8.66667 12L20 20V4L8.66667 12Z") !important;
}
/* Repeat all button icon */
ytmusic-player-bar #play-pause-button[aria-label="Repeat All"] yt-icon svg path,
ytmusic-player-bar #play-pause-button[aria-label="Repeat All"] svg path,
ytmusic-player-bar yt-icon-button[aria-label="Repeat All"] yt-icon svg path,
ytmusic-player-bar button[aria-label="Repeat All"] yt-icon svg path,
ytmusic-player-bar yt-icon[aria-label="Repeat All"] svg path,
ytmusic-player-bar [aria-label="Repeat All"] svg path {
    d: path("M4 4H6.66667V20H4V4ZM8.66667 12L20 20V4L8.66667 12Z") !important;
}

/* Repeat one button icon */
ytmusic-player-bar #play-pause-button[aria-label="Repeat One"] yt-icon svg path,
ytmusic-player-bar #play-pause-button[aria-label="Repeat One"] svg path,
ytmusic-player-bar yt-icon-button[aria-label="Repeat One"] yt-icon svg path,
ytmusic-player-bar button[aria-label="Repeat One"] yt-icon svg path,
ytmusic-player-bar yt-icon[aria-label="Repeat One"] svg path,
ytmusic-player-bar [aria-label="Repeat One"] svg path {
    d: path("M4 4H6.66667V20H4V4ZM8.66667 12L20 20V4L8.66667 12Z") !important;
}